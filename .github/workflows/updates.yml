name: Mediathekview Updates
on:
  workflow_dispatch:

jobs:
  tag-new-versions:
    runs-on: ubuntu-latest

    permissions:
      contents: write

    steps:
      - uses: oprypin/find-latest-tag@v1
        with:
          repository: actions/runner-images  # The repository to scan.
          releases-only: true  # We know that all relevant tags have a GitHub release for them.
          prefix: 'ubuntu24'
        id: octokit  # The step ID to refer to later.
    
      - run: echo "Octokit is at version ${{ steps.octokit.outputs.tag }}"

      - uses: peterjgrainger/action-create-branch@v2.2.0
        env:
          GITHUB_TOKEN: ${{ secrets.GH_TOKEN }}
        with:
          branch: ${{ steps.octokit.outputs.tag }}
          #sha: '${{ github.event.pull_request.head.sha }}'

      - name: Checkout new created branch
        uses: actions/checkout@v4
        with:
          ref: ${{ steps.octokit.outputs.tag }}

      - name: Create release for ${{ steps.octokit.outputs.tag }}
        uses: ncipollo/release-action@v1.14.0
        with:
          tag: ${{ steps.octokit.outputs.tag }}
          name: ${{ github.event.client_payload.ReleaseTitle }}
          body: ${{ github.event.client_payload.ReleaseBody }}
          prerelease: ${{ github.event.client_payload.Prerelease }}
          commit: ${{ github.event.client_payload.Commitish }}
          token: ${{ secrets.GH_TOKEN }}
