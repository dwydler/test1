name: Test tag exist
on:
  workflow_dispatch:
  
jobs:
  BasicInformations:
    runs-on: ubuntu-latest
      
    steps:
      - name: Get current date
        id: date
        run: echo "::set-output name=date::$(date +'%Y%m%d')"
        
    outputs:
      ReleaseName: Ubuntu 24.04 (${{ steps.date.outputs.date }}) Image Update
      ReleaseTag: ubuntu24/${{ steps.date.outputs.date }}.1

  Test:
    runs-on: ubuntu-latest
      
    steps:      
      - uses: mukunku/tag-exists-action@v1.6.0
        id: check-tag
        with: 
          #tag: ${{ needs.BasicInformations.outputs.ReleaseTag }}
          tag: ubuntu24/20250311.*
          repo: 'dwydler/test1'

      - name: Split branch name
        env:
          BRANCH: ${{ needs.BasicInformations.outputs.ReleaseTag }}
        id: split
        run: echo "fragment=${BRANCH##*/}" >> $GITHUB_OUTPUT

      - name: Test variable
        run: |
          echo ${{ steps.split.outputs.fragment }}
        
      - name: determine docker tag by splitting branch name on slash
        if: steps.check-tag.outputs.exists == 'true'
        id: docker-tag
        shell: bash
        run: |
          split=(${needs.BasicInformations.outputs.ReleaseTag//\// })
          index=$((${#split[@]}-1))
          DOCKER_TAG=${split[$index]}
          echo DOCKER_TAG=$DOCKER_TAG >> $GITHUB_ENV
          echo "::set-output name=DOCKER_TAG::$DOCKER_TAG"
